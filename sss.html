</body>
</html><!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏î‡∏π‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f9f9f9;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
    }
    label {
      font-size: 16px;
    }
    input {
      width: 100%;
      padding: 10px;
      margin-top: 8px;
      margin-bottom: 20px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    button {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 10px;
    }
    button:hover {
      background-color: #45a049;
    }
    .order-details {
      margin-top: 30px;
      padding: 20px;
      background-color: #f1f1f1;
      border-radius: 8px;
    }
    .order-details p {
      font-size: 16px;
      margin: 8px 0;
    }
    .order-products {
      margin-top: 20px;
    }
    .product-list {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }
    .product-list img {
      width: 60px;
      height: 60px;
      margin-right: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>‡∏î‡∏π‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</h1>

    <label for="orderIdInput">‡∏Å‡∏£‡∏≠‡∏Å ID ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠:</label>
    <input type="text" id="orderIdInput" placeholder="‡∏Å‡∏£‡∏≠‡∏Å ID ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠">
    <button id="viewOrderButton">‡∏î‡∏π‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</button>

    <div id="orderDetails" class="order-details"></div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.3.0/firebase-app.js";
    import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/11.3.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBTcik7Ldm_Bv_nwY8jq0xdhCx6LwUhu8g",
      authDomain: "sdtc-b8863.firebaseapp.com",
      projectId: "sdtc-b8863",
      storageBucket: "sdtc-b8863.firebasestorage.app",
      messagingSenderId: "1077154268954",
      appId: "1:1077154268954:web:a385080364aa9759994ea3",
      measurementId: "G-WZBWX7B35M"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const viewOrderButton = document.getElementById("viewOrderButton");
    const orderDetails = document.getElementById("orderDetails");

    viewOrderButton.addEventListener("click", () => {
      const orderId = document.getElementById("orderIdInput").value.trim();
      if (orderId) {
        loadOrderDetails(orderId);
      } else {
        alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å ID ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠");
      }
    });

    async function loadOrderDetails(orderId) {
      const orderDocRef = doc(db, "orders", orderId);
      const orderDoc = await getDoc(orderDocRef);

      if (orderDoc.exists()) {
        const order = orderDoc.data();
        const createdAt = order.createdAt ? new Date(order.createdAt.seconds * 1000).toLocaleString() : "‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏";

        let productHTML = "";
        if (order.products && order.products.length > 0) {
          productHTML = order.products.map(item => `
            <div class="product-list">
              <img src="${item.image}" alt="${item.name}">
              <p><strong>${item.name}</strong> - ${item.price} ‡∏ö‡∏≤‡∏ó</p>
            </div>
          `).join("");
        }

        const orderHtml = `
          <h3>üÜî ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠: ${orderId}</h3>
          <p><strong>üë§ ‡∏ä‡∏∑‡πà‡∏≠:</strong> ${order.name}</p>
          <p><strong>üìß ‡∏≠‡∏µ‡πÄ‡∏°‡∏•:</strong> ${order.email || "‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏"}</p>
          <p><strong>üìç ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</strong> ${order.address}</p>
          <p><strong>üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</strong> ${order.note || "‡πÑ‡∏°‡πà‡∏°‡∏µ"}</p>
          <p><strong>üìÖ ‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠:</strong> ${createdAt}</p>
          <p><strong>üí∞ ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°:</strong> ${order.totalPrice} ‡∏ö‡∏≤‡∏ó</p>
          <div class="order-products">${productHTML}</div>
          <p><strong>üì¶ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</strong> ${order.status}</p>
        `;

        orderDetails.innerHTML = orderHtml;
        addActionButtons(orderId, order.status);
      } else {
        alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏°‡∏µ ID ‡∏ô‡∏µ‡πâ");
        orderDetails.innerHTML = "";
      }
    }

    // ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏∏‡πà‡∏° "‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß" ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡πá‡∏ô "‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à"
    function addActionButtons(orderId, status) {
      orderDetails.innerHTML += `<br>`;
      if (status === "‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à") {
        addReceivedButton(orderId);
      }
    }

    function addReceivedButton(orderId) {
      const receivedButton = document.createElement("button");
      receivedButton.textContent = "üéÅ ‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß";
      receivedButton.onclick = () => receivedOrder(orderId);
      orderDetails.appendChild(receivedButton);
    }

    async function receivedOrder(orderId) {
      const orderDocRef = doc(db, "orders", orderId);
      await updateDoc(orderDocRef, { status: "‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß" });
      alert("üéâ ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß");
      loadOrderDetails(orderId);
    }
  </script>
</body>
</html>
